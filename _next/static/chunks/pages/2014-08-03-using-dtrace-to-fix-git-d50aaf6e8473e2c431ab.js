_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[14],{E0CK:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));var i=n("nKUr"),o=n("1OyB"),r=n("vuIU"),c=n("Ji7U"),a=n("md7G"),s=n("foSv"),l=n("q1tI"),u=n("Oqge"),h=n("wOhW"),d=n("wXCX");function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Object(s.a)(e);if(t){var o=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}var m=function(e){Object(c.a)(n,e);var t=f(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){return Object(i.jsxs)(h.a,{title:"Using dtrace to fix git",children:[Object(i.jsx)("h2",{className:"blog-post-title",children:"Using dtrace to fix git"}),Object(i.jsx)(d.a,{posted:"03 Aug 2014"}),Object(i.jsxs)("p",{children:["First off the problem.  I like to develop on ",Object(i.jsx)("a",{href:"http://smartos.org/",children:"smartos"})," because it is based on Solaris and has all of the conveniences of Linux with a few extras namely zfs, zones and dtrace.  It\u2019s dtrace that I\u2019m going to discuss today.  I run a very specialized version of vim.  By specialized I mean I have a bunch of ",Object(i.jsx)("a",{href:"https://github.com/socketwiz/dotfiles/tree/master/.vim/bundle",children:"addons"}),".  In particular, ",Object(i.jsx)("a",{href:"https://github.com/Valloric/YouCompleteMe",children:"YouCompleteMe"})," and ",Object(i.jsx)("a",{href:"https://github.com/SirVer/ultisnips",children:"UltiSnips"})," requires that vim be a particular version and have python support compiled in.  The vim for smartos unfortunately does not so I build my own.  This leads us to my problem.  I also use git and when I do commits I want it to use vim, specifically my custom vim, otherwise it throws an error on startup complaining about the lack of python support."]}),Object(i.jsx)("div",{className:"highlighter-rouge",children:Object(i.jsx)("pre",{className:"highlight",children:Object(i.jsx)("code",{children:"YouCompleteMe unavailable: requires Vim 7.3.584+\nUltiSnips requires py &gt;= 2.6 or any py3\nPress ENTER or type command to continue"})})}),Object(i.jsx)("p",{children:"To fix this there are two options:"}),Object(i.jsxs)("ol",{children:[Object(i.jsx)("li",{children:'git config \u2013global core.editor "/path/to/vim"'}),Object(i.jsx)("li",{children:"set the GIT_EDITOR, VISUAL, or EDITOR environment variables."})]}),Object(i.jsx)("p",{children:"I opted for the later because I share my $HOME/.gitconfig on 3 different systems, smartos, mac, and windows, and vim lives in different locations on each of them.  The environment variable would be the ideal solution but it seems to be ignored because I have EDITOR set already.  I tried setting GIT_EDITOR to no avail.  So what\u2019s going on and more importantly how can I fix it?  One option might be to download the source code for git and try to debug it and figure out what the problem is, but that seems like a lot of work for such a small annoyance.  I chose to utilize dtrace, after all theres no since running on smartos if you\u2019re not going to take advantage of its conveniences. My goal was to try and figure out where git was searching for vim in an attempt to try and figure out why it was not finding my vim, and instead using the system vim.  My path has my vim ahead of the system vim so in theory it should have found it.  Here is the command I came up with:"}),Object(i.jsx)("div",{className:"highlighter-rouge",children:Object(i.jsx)("pre",{className:"highlight",children:Object(i.jsxs)("code",{children:['dtrace -n \'syscall::exec*:entry /execname=="git"/ ',"{",' printf("%s\\n", copyinstr(arg0)); ',"}","'"]})})}),Object(i.jsx)("p",{children:"I fired up tmux because I run smartos remotely and I wanted to take advantage of the multiple windows so I didn\u2019t have to make 2 ssh connections.  In the first window I ran sudo -i because dtrace wants to run as root, then I ran the command above.  In the second window I ran \u201cgit commit\u201d and here is what dtrace output:"}),Object(i.jsx)("div",{className:"highlighter-rouge",children:Object(i.jsx)("pre",{className:"highlight",children:Object(i.jsx)("code",{children:"dtrace: description 'syscall::exec*:entry ' matched 1 probe\nCPU     ID                    FUNCTION:NAME\n3   7129                      exece:entry /opt/local/libexec/git-core/vi\n\n3   7129                      exece:entry /opt/local/bin/vi\n\n3   7129                      exece:entry /opt/local/bin/vi\n\n3   7129                      exece:entry /usr/local/sbin/vi\n\n3   7129                      exece:entry /usr/local/bin/vi\n\n3   7129                      exece:entry /opt/local/sbin/vi\n\n3   7129                      exece:entry /opt/local/bin/vi\n\n3   7129                      exece:entry /usr/sbin/vi\n\n3   7129                      exece:entry /usr/bin/vi"})})}),Object(i.jsx)("p",{children:"Aha! I don\u2019t understand why, but for some reason it\u2019s not looking for vim at all, it\u2019s looking for vi.  I could fix this in one of two ways.  Download the source for git and try and figure out why it\u2019s doing this, or simply make a symbolic link from vi to my vim and call it a day.  I chose the latter:"}),Object(i.jsx)("div",{className:"highlighter-rouge",children:Object(i.jsx)("pre",{className:"highlight",children:Object(i.jsx)("code",{children:"sudo ln -s /opt/local/bin/vim /opt/local/bin/vi"})})}),Object(i.jsx)("p",{children:"Now when I run \u201cgit commit\u201d I get:"}),Object(i.jsx)("div",{className:"highlighter-rouge",children:Object(i.jsx)("pre",{className:"highlight",children:Object(i.jsx)("code",{children:"dtrace: description 'syscall::exec*:entry ' matched 1 probe\nCPU     ID                    FUNCTION:NAME\n1   7129                      exece:entry /opt/local/libexec/git-core/vi\n\n1   7129                      exece:entry /opt/local/bin/vi"})})}),Object(i.jsx)("p",{children:"As well as the proper vim that I\u2019m expecting."}),Object(i.jsx)(u.a,{})]})}}]),n}(l.Component)},Oqge:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n("nKUr"),o=n("1OyB"),r=n("vuIU"),c=n("Ji7U"),a=n("md7G"),s=n("foSv"),l=n("q1tI");function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Object(s.a)(e);if(t){var o=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}var h=function(e){Object(c.a)(n,e);var t=u(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"disqus",value:function(){if("undefined"!==typeof document){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//socketwiztechnicalblog.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}}},{key:"componentDidMount",value:function(){this.disqus()}},{key:"render",value:function(){return Object(i.jsx)("div",{children:Object(i.jsx)("div",{id:"disqus_thread"})})}}]),n}(l.Component)},oNEu:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/2014-08-03-using-dtrace-to-fix-git",function(){return n("E0CK")}])},wXCX:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n("nKUr"),o=n("1OyB"),r=n("vuIU"),c=n("Ji7U"),a=n("md7G"),s=n("foSv"),l=n("q1tI");function u(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Object(s.a)(e);if(t){var o=Object(s.a)(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Object(a.a)(this,n)}}var h=function(e){Object(c.a)(n,e);var t=u(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"twitterShare",value:function(e,t){if("undefined"!==typeof document){var n,i=document.getElementsByTagName(e)[0],o=/^http:/.test(document.location)?"http":"https";document.getElementById(t)||((n=document.createElement(e)).id=t,n.src=o+"://platform.twitter.com/widgets.js",i.parentNode.insertBefore(n,i))}}},{key:"componentDidMount",value:function(){this.twitterShare("script","twitter-wjs")}},{key:"render",value:function(){var e=this.props.posted;return Object(i.jsx)("div",{children:Object(i.jsxs)("p",{className:"blog-post-meta",children:[Object(i.jsx)("span",{className:"glyphicon glyphicon-calendar"})," ",e," ",Object(i.jsx)("a",{href:"https://twitter.com/share",className:"twitter-share-button","data-via":"socketwiz",children:"Tweet"})]})})}}]),n}(l.Component)}},[["oNEu",0,1,2]]]);